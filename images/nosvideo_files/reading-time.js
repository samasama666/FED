var _smoc=_smoc||{};function trackReadingTime(s,a){if(!(s=s||{}).brandId)return console.log("AttentionTime - Brand id is required config parameter!"),!1;if(!s.relationId)return console.log("AttentionTime - Relation id is required config parameter!"),!1;if(!a)return console.error("AttentionTime - No ingestionInstance defined, so we can't collect data."),!1;function c(t){if((t=>{var e,n=l("excludeContent")||s.excludeContent;if(n)return((e=Element.prototype).matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)}).call(t,n)})(t))return"";for(var e="",n=t.childNodes.length,o=0;o<n;o++){var i=t.childNodes[o];8!=i.nodeType&&-1===r.indexOf(i.tagName)&&(e+=1!=i.nodeType?i.nodeValue:c(i))}return e}function l(t){return t in window.tentacles?window.tentacles[t]:""}var t=(new Date).getTime(),r=["SCRIPT","STYLE","CANVAS","MAP","PICTURE","IMG","VIDEO","OBJECT","SVG","IFRAME"];_smoc.atobj={signalName:"readingTime",secondsBetweenBeats:5.5,activeTimeout:5,sampleRateSeconds:.1,eventNames:["focus","mousedown","mouseup","mousemove","scroll","touchstart","touchenter","keyup","keydown"],selectedText:""},Object.assign(_smoc.atobj,s),_smoc.atobj._lastEvent=t,_smoc.atobj._lastSample=t,_smoc.atobj._engagedMs=0,_smoc.atobj._engagedMsTotal=0,_smoc.atobj.isEngaged=!0,_smoc.atobj.isInteracting=!0,_smoc.atobj.focused=!0,_smoc.atobj.videoPlaying=!1,_smoc.atobj.sequenceNum=1,_smoc.atobj._mcel=!1,_smoc.atobj._mcelwc=null;if(_smoc.getWordCount=function(t){var e=parseInt(l("wordCount"));return e&&0<e?e:(_smoc.atobj.selectedText=t.filter(function(t){return!!t}).reduce(function(t,e){return t+" "+c(e)},""),_smoc.atobj.selectedText.split(/\s+/).length)},_smoc.getMainContentEl=function(t){var e=t||"[data-ci-maincontent]",n=[];if("function"!=typeof document.querySelector)return null;try{n=e.split(",").map(function(t){return document.querySelector(t)}).filter(function(t){return!!t})}catch(t){console.log("AttentionTime - error on getting main content el",t)}return n.length?n:null},_smoc.atobj._stid&&clearTimeout(_smoc.atobj._stid),_smoc.atobj._stid=setTimeout(function(){_smoc.atobj._mcel&&(_smoc.atobj._mcelwc=_smoc.getWordCount(_smoc.atobj._mcel))},1e4),function(){window._visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(t){"function"==typeof t&&this.visibleCallbacks.push(t)},onHidden:function(t){"function"==typeof t&&this.hiddenCallbacks.push(t)},getPrefix:function(){if(!this.cachedPrefix)for(var t=0;bb=this.prefixes[t++];)if(bb+this.props[2]in this.q)return this.cachedPrefix=bb,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(t){"function"==typeof t&&this.genericCallbacks.push(t);var e=this.genericCallbacks.length;if(e)if(this.cachedPrefix)for(;e--;)this.genericCallbacks[e].call(this,this.visibilityState());else for(;e--;)this.genericCallbacks[e].call(this,t)},isSupported:function(t){return this._getPropName(2)in this.q},_getPropName:function(t){return""===this.cachedPrefix?this.props[t].substring(0,1).toLowerCase()+this.props[t].substring(1):this.cachedPrefix+this.props[t]},_getProp:function(t){return this.q[this._getPropName(t)]},_execute:function(t){if(t){this._callbacks=1===t?this.visibleCallbacks:this.hiddenCallbacks;for(var e=this._callbacks.length;e--;)this._callbacks[e]()}},_visible:function(){window._visibly._execute(1),window._visibly.visibilitychange.call(window._visibly,"visible")},_hidden:function(){window._visibly._execute(2),window._visibly.visibilitychange.call(window._visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){window._visibly._nativeSwitch.apply(window._visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(t){console.log("AttentionTime - error on visibility",t)}},init:function(){this.getPrefix(),this._listen()}},this._visibly.init()}(),window._visibly.onVisible(function(){_smoc.atobj.focused=!0}),window._visibly.onHidden(function(){_smoc.atobj.focused=!1}),void 0===_smoc.atregisterEvent){var e=function(t,e){window.addEventListener?window.addEventListener(t,e,!1):document.attachEvent("on"+t,e)};_smoc.atregisterEvent=function(){_smoc.atobj._lastEvent=(new Date).getTime()};for(var n=0;n<_smoc.atobj.eventNames.length;n++)e(_smoc.atobj.eventNames[n],_smoc.atregisterEvent);_smoc.atsample=function(){var t=(new Date).getTime();_smoc.atobj.isInteracting=t-_smoc.atobj._lastEvent<1e3*_smoc.atobj.activeTimeout,_smoc.atobj.isEngaged=_smoc.atobj.isInteracting&&_smoc.atobj.focused||_smoc.atobj.videoPlaying,_smoc.atobj._engagedMs+=_smoc.atobj.isEngaged?t-_smoc.atobj._lastSample:0,_smoc.atobj._lastSample=t},window.tentacles_at_timer_sample=window.setInterval(_smoc.atsample,1e3*_smoc.atobj.sampleRateSeconds),_smoc.atSendBeat=function(){!1===_smoc.atobj._mcel&&(_smoc.atobj._mcel=_smoc.getMainContentEl(l("mainContent")||s.mainContent),_smoc.atobj._mcel||console.log("AttentionTime - error on getting main content el"));var t,e,n,o,i=Math.round(_smoc.atobj._engagedMs/1e3);0<i&&i<=Math.round(_smoc.atobj.secondsBetweenBeats)&&(_smoc.atobj._engagedMsTotal+=i,i={brandId:_smoc.atobj.brandId,relationId:_smoc.atobj.relationId,ar:i,at:_smoc.atobj._engagedMsTotal},_smoc.atobj._mcel&&(i.sp=(e=_smoc.atobj._mcel,t=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=e.reduce(function(t,e){return t.getBoundingClientRect().top>e.getBoundingClientRect().top?e:t}),e=e.reduce(function(t,e){return t.getBoundingClientRect().bottom<e.getBoundingClientRect().bottom?e:t}),e=Math.abs(n.getBoundingClientRect().top-e.getBoundingClientRect().bottom),n=n.getBoundingClientRect().top,o=0,100<(o=Math.round(100*(t-n)/e))?o=Math.abs(n)>=e?0:100:o<0&&(o=0),o)),_smoc.atobj._mcelwc&&(i.wc=_smoc.atobj._mcelwc),a)&&a.signal(_smoc.atobj.signalName,i),_smoc.atobj._engagedMs=0},window.tentacles_at_timer_send_beat=window.setInterval(_smoc.atSendBeat,1e3*_smoc.atobj.secondsBetweenBeats),e("unload",_smoc.atSendBeat)}else void 0!==_smoc.atsample&&void 0!==_smoc.atSendBeat?(window.tentacles_at_timer_sample=window.setInterval(_smoc.atsample,1e3*_smoc.atobj.sampleRateSeconds),window.tentacles_at_timer_send_beat=window.setInterval(_smoc.atSendBeat,1e3*_smoc.atobj.secondsBetweenBeats)):console.log("AttentionTime - Method _smoc.atsample or _smoc.atSendBeat were not defined but _smoc.atregisterEvent was defined.")}window.tentacles_at_timer_sample=null,window.tentacles_at_timer_send_beat=null;