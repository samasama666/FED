var _ain=_ain||{};_ain.widget=_ain.widget||[],_ain.version=19,_ain.E_NO_EL=1,_ain.E_INV_EL=2,_ain.E_NO_SOC=3,_ain.E_LSTN=4,_ain.E_INCORRECT_OPTION_ACCESS_LEVEL=5,_ain.E_INCORRECT_OPTION_READER_TYPE=6,_ain.errors=[],_ain.DEFAULT_RECOMMENDATION_ELEMENT=".ain-rcm-widget",_ain.CID_KEY="_ain_cid",_ain.CID_TIME=18e5,_ain.UID_KEY="_ain_uid",_ain.UID_TIME=63072e6,_ain.DEFAULT_CANCEL_REQUEST_TIME=2e3,_ain.cancelRequestTime=_ain.cancelRequestTime||_ain.DEFAULT_CANCEL_REQUEST_TIME,_ain.config={pv_url:["ingestion.contentinsights.com/p"],at_url:["ingestion.contentinsights.com/a"],cr_url:"cr-seg.contentinsights.com/widget",cr_css:"cr-seg.contentinsights.com/widget/css/main.css",conversion_url:"https://conversions.contentinsights.com/v1/"},_ain.track=function(){if(!_ain.id)return!1;_ain.running=!0,_ain.init()},_ain.stop=function(){_ain.running=!1},_ain.createExpirationDate=function(e){var n=new Date;return n.setTime(n.getTime()+e),n.toGMTString()},_ain.generateCID=function(){return(new Date).getTime()+"."+1e9*Math.random()},_ain.getFromCookie=function(e){var n=e+"=",t=document.cookie.split(";"),i=0;for(i;i<t.length;i+=1){for(var a=t[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(n))return a.substring(n.length,a.length)}return null},_ain.getCookieId=function(e){if(e!==_ain.CID_KEY&&e!==_ain.UID_KEY)return null;var n=_ain.getFromCookie(e);if(null===n){var t=e===_ain.CID_KEY?_ain.CID_TIME:_ain.UID_TIME;if(document.cookie=e+"="+_ain.generateCID()+"; expires="+_ain.createExpirationDate(t)+"; path=/",null===(n=_ain.getFromCookie(e)))return null}else e===_ain.UID_KEY&&(document.cookie=e+"="+n+"; expires="+_ain.createExpirationDate(_ain.UID_TIME)+"; path=/");return n},_ain.sendPostRequest=function(e,n,t,i){var a=new XMLHttpRequest,o=JSON.stringify(n);a.onreadystatechange=function(){4===a.readyState&&(200==a.status||204==a.status?"function"==typeof t&&t(a.responseText,n):"function"==typeof i&&i(a.responseText,n))},a.open("POST",e),a.setRequestHeader("Content-type","application/json"),a.send(o)},_ain.getProtocol=function(){return"https:"==document.location.protocol?"https":"http"},_ain.getRecommendationUrl=function(){return _ain.getProtocol()+"://"+_ain.config.cr_url},_ain.getCssUrl=function(){return _ain.getProtocol()+"://"+_ain.config.cr_css},_ain.loadCSS=function(e){var n=document.createElement("link");n.href=e,n.type="text/css",n.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(n)},_ain.loadCustomCSS=function(e){if(e){var n=document.createElement("style");n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n)}},_ain.populateWidget=function(e){if(e=e||{},e.element=e.element||_ain.DEFAULT_RECOMMENDATION_ELEMENT,!document.querySelector(e.element))return console.log("Missing widget element!"),!1;if(!_ain.id)return console.log("Missing domain id!"),!1;e.css&&(_ain.loadCustomCSS(e.css),delete e.css),e.domain=_ain.id,e.pid=_ain.postid,e.relatedSections=_ain.sections,e.cookie=_ain.getCookieId(_ain.UID_KEY);var n=function(e,n){document.querySelector(n.element).innerHTML=e},t=function(e,n){console.log("Error on load recommendation!",n,e)},i=_ain.getRecommendationUrl();_ain.sendPostRequest(i,e,n,t)},_ain.precessWidgets=function(){if(_ain.widget&&Array.isArray(_ain.widget)&&_ain.widget.length>0){var e=_ain.getCssUrl();_ain.loadCSS(e);for(var n=0;n<_ain.widget.length;n++)try{_ain.populateWidget(_ain.widget[n])}catch(e){console.log("Error on precessWidgets",e)}}},_ain.getConversionUrl=function(){return _ain.config.conversion_url},_ain.getUID=function(){return _ain.uid||null},_ain.pushConversion=function(e,n,t){var t=t||null,n=n||null,i=_ain.getConversionUrl(),a={domain_id:_ain.id,event:e,ul:_ain.getCookieId(_ain.UID_KEY)};_ain.getUID()&&(a.uid=_ain.getUID()),null!==t&&(a.timestamp=t),null!==n&&(a.data=n);var o=function(e,n){console.log("Conversion successfully sent.",n,e)},r=function(e,n){console.log("Error on push conversion!",n,e)};_ain.sendPostRequest(i,a,o,r)},_ain.init=function(){function sendRequest(e,n){if(!1===_ain.running)return!1;for(var t=0;t<e.length;t++)(new Image).src=("https:"==document.location.protocol?"https":"http")+"://"+e[t]+n}function getSocial(e,n){function t(e,n,t,i,a){if("undefined"!=typeof Worker){void 0===i&&(i="");var o="";for(var r in n)o+="&"+r+"="+n[r];if("xhr"===a)var s=new Blob([i+"var cb = function(val) { try {postMessage(JSON.parse(val));} catch (ex){} };try { var xhr = new XMLHttpRequest();xhr.open('GET', '"+e+"?x="+Math.random()+o+"', true);xhr.onreadystatechange = function() {if (xhr.readyState === 4 && xhr.status === 200) {cb(xhr.responseText);}};xhr.withCredentials = false;xhr.timeout = 3000;xhr.ontimeout = function() {};xhr.send('');} catch (ex) {}"],{type:"text/json"});else var s=new Blob([i+"var cb = function(val) { postMessage(val) };try { importScripts('"+e+"?callback=cb"+o+"&x="+Math.random()+"'); } catch (ex) {}"],{type:"text/javascript"});var c=window.URL.createObjectURL(s),l=new Worker(c);l.onmessage=function(e){t(e),l.terminate()},l.onerror=function(){},setTimeout(function(){l.terminate()},1e4)}}for(var i=["fb_count","vk_like","vk_share","ok_count","ln_count","pn_count","gp_count"],a=[0,1,2],o=[4,2,1],r=0,s=0;s<o.length;s++)r+=o[s];for(var c=[],l=0;l<a.length;){for(s=0;s<o[l];s++)c[c.length]=a[l];l++}switch(c[Math.floor(Math.random()*r)]){case 0:break;case 1:isSocialCountPredefined("ln_count")||t("https://www.linkedin.com/countserv/count/share",{format:"jsonp",url:e},function(e){void 0!==e.data.count&&n("&ln_count="+e.data.count)}),isSocialCountPredefined("pn_count")||t("https://api.pinterest.com/v1/urls/count.json",{url:e},function(e){void 0!==e.data.count&&n("&pn_count="+e.data.count)})}for(var _ in i)isSocialCountPredefined(i[_])&&n("&"+i[_]+"="+getSocialPredefinedCount(i[_]))}function isSocialCountPredefined(e){return!!(_ain.social&&e in _ain.social)}function getSocialPredefinedCount(e){return isSocialCountPredefined(e)?_ain.social[e]:0}function prepareParam(e){return void 0!==e?encodeURIComponent(e):""}function getValidAdditionalOption(optionId){return optionId in _ain?-1==eval(optionId.toUpperCase()+"_DEFAULTS").indexOf(_ain[optionId])?(_ain.errors.push(_ain["E_INCORRECT_OPTION_"+optionId.toUpperCase()]),""):_ain[optionId]:""}function getBaseAdditionalOption(e){return e in _ain?_ain[e]:""}function getLink(e,n){var t=e.querySelector("link[rel='canonical']"),i=e.querySelector("meta[property='og:url']");return null!==t?t.getAttribute("href"):null!==i?i.getAttribute("content"):n||e.URL}function getCampaignData(){for(var e="",n=location.search.substr(1).split("&"),t=0;t<n.length;t++)"utm_"==n[t].substring(0,4)&&(e+="&"+n[t]);return e}function getCustomData(){var e="";if("data"in _ain)for(var n in _ain.data){var t=_ain.data[n];t="object"==typeof t?JSON.stringify(t):t,e+="&"+n+"="+prepareParam(t)}return e}function p(e){return-1==e.indexOf("://")&&(e=g.location.protocol+(0==e.indexOf("//")?"":"//")+e),e}function getText(e){if(isExcludedContent(e))return"";for(var n="",t=e.childNodes.length,i=0;i<t;i++){var a=e.childNodes[i];8==a.nodeType||isElementOnBlackList(a)||(n+=1!=a.nodeType?a.nodeValue:getText(a))}return n}function getTopmostElement(e){return e.reduce(function(e,n){return e.getBoundingClientRect().top>n.getBoundingClientRect().top?n:e})}function getBottommostElement(e){return e.reduce(function(e,n){return e.getBoundingClientRect().bottom<n.getBoundingClientRect().bottom?n:e})}function getMainContentPosition(e){var n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),t=getTopmostElement(e),i=getBottommostElement(e),a=Math.abs(t.getBoundingClientRect().top-i.getBoundingClientRect().bottom),o=t.getBoundingClientRect().top,r=0;return r=Math.round(100*(n-o)/a),r>100?r=Math.abs(o)>=a?0:100:r<0&&(r=0),r}_ain.selectedText="";var elementsBlackList=["SCRIPT","STYLE","CANVAS","MAP","PICTURE","IMG","VIDEO","OBJECT","SVG","IFRAME"],OPTION_ACCESS_LEVEL="access_level",OPTION_ARTICLE_TYPE="article_type",OPTION_IMAGE="image",OPTION_READER_TYPE="reader_type",OPTION_WORD_COUNT="word_count",OPTION_EXCLUDE_CONTENT="excludecontent",ACCESS_LEVEL_DEFAULTS=["free","preview","paid"],READER_TYPE_DEFAULTS=["anonymous","registered","subscribed"];_ain.getWordCount=function(e){var n=parseInt(getBaseAdditionalOption("word_count"));return n&&n>0?n:(_ain.selectedText=e.filter(function(e){return!!e}).reduce(function(e,n){return e+=" "+getText(n)},""),_ain.selectedText.split(/\s+/).length)};var isElementOnBlackList=function(e){return-1!==elementsBlackList.indexOf(e.tagName)},isExcludedContent=function(e){var n=getBaseAdditionalOption("excludecontent");if(!n)return!1;var t=Element.prototype;return(t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||function(e){return-1!==[].indexOf.call(document.querySelectorAll(e),this)}).call(e,n)};_ain.getMainContentEl=function(e){var n=e,t=[];if(!n){var i={5:'[data-url="'+j.url+'"] .post',1304:"#article .info",1285:".article__content",1298:"#detail",1321:"#d_conmment_holder"};n=i[did]?i[did]:"[data-ci-maincontent]"}if("function"!=typeof document.querySelector)return null;try{t=n.split(",").map(function(e){return document.querySelector(e)}).filter(function(e){return!!e})}catch(e){_ain.errors.push(_ain.E_INV_EL)}return t.length?t:null};var g=document,j=_ain,h=_ain.getCookieId(_ain.CID_KEY),f=_ain.getCookieId(_ain.UID_KEY),d=prepareParam(p(j.url||getLink(g))),did=prepareParam(j.id),pid=j.postid?"&pid="+prepareParam(j.postid):"1208"==did?"&pid="+prepareParam(getLink(g)):"",x=Math.random(),r=prepareParam(j.referrer||g.referrer),b="?a="+prepareParam(j.authors);if(b+="&b="+r,b+="&c="+prepareParam(j.title||g.title),b+="&d="+d,b+="&e="+prepareParam(j.sections),b+="&f="+did,b+="&g="+prepareParam(j.pubdate),b+="&h="+prepareParam(j.tags),b+="&i="+prepareParam(j.comments),b+="&j="+prepareParam(getValidAdditionalOption("access_level")),b+="&k="+prepareParam(getBaseAdditionalOption("article_type")),b+="&l=",b+="&m="+prepareParam(getValidAdditionalOption("reader_type")),b+=pid,j._mcel=!1,j._mcelwc=null,null!==h&&null!==f){if(b+="&u="+h,b+="&ul="+f,b+="&x="+x,b+=getCampaignData(),b+=getCustomData(),_ain.getUID()&&(b+="&uid="+_ain.getUID()),did){try{getSocial(prepareParam(p(j.social_url||j.url||g.URL)),function(e){b+=e})}catch(e){_ain.errors.push(_ain.E_NO_SOC)}var paramsPageViewEvent=b+"&t=0&err="+prepareParam(_ain.errors.join())+"&ver="+_ain.version;sendRequest(_ain.config.pv_url,paramsPageViewEvent),j._stid&&clearTimeout(j._stid),j._stid=setTimeout(function(){j._mcelwc=j._mcel?"&wc="+_ain.getWordCount(j._mcel):"";var e=b+j._mcelwc+"&t=1&err="+prepareParam(_ain.errors.join())+"&ver="+_ain.version;sendRequest(_ain.config.pv_url,e)},1e4)}!function(){window.visibly={q:document,p:void 0,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(e){"function"==typeof e&&this.visibleCallbacks.push(e)},onHidden:function(e){"function"==typeof e&&this.hiddenCallbacks.push(e)},getPrefix:function(){if(!this.cachedPrefix)for(var e=0;bb=this.prefixes[e++];)if(bb+this.props[2]in this.q)return this.cachedPrefix=bb,this.cachedPrefix},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(e){"function"==typeof e&&this.genericCallbacks.push(e);var n=this.genericCallbacks.length;if(n)if(this.cachedPrefix)for(;n--;)this.genericCallbacks[n].call(this,this.visibilityState());else for(;n--;)this.genericCallbacks[n].call(this,arguments[0])},isSupported:function(e){return this._getPropName(2)in this.q},_getPropName:function(e){return""==this.cachedPrefix?this.props[e].substring(0,1).toLowerCase()+this.props[e].substring(1):this.cachedPrefix+this.props[e]},_getProp:function(e){return this.q[this._getPropName(e)]},_execute:function(e){if(e){this._callbacks=1==e?this.visibleCallbacks:this.hiddenCallbacks;for(var n=this._callbacks.length;n--;)this._callbacks[n]()}},_visible:function(){window.visibly._execute(1),window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2),window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{this.isSupported()?this.q.addEventListener(this._getPropName(1),function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1):this.q.addEventListener?(window.addEventListener(this.m[0],this._visible,1),window.addEventListener(this.m[1],this._hidden,1)):this.q.attachEvent&&(this.q.attachEvent("onfocusin",this._visible),this.q.attachEvent("onfocusout",this._hidden))}catch(e){_ain.errors.push(_ain.E_LSTN)}},init:function(){this.getPrefix(),this._listen()}},this.visibly.init()}(),function(){_ain.atparams={d:d,did:did,pid:pid,h:h,f:f,x:x},_ain.atobj={secondsBetweenBeats:5.5,activeTimeout:5,sampleRateSeconds:.1,eventNames:["focus","mousedown","mouseup","mousemove","scroll","touchstart","touchenter","keyup","keydown"]};var e=(new Date).getTime();if(_ain.atobj._lastEvent=e,_ain.atobj._lastSample=e,_ain.atobj._engagedMs=0,_ain.atobj._engagedMsTotal=0,_ain.atobj.isEngaged=!0,_ain.atobj.isInteracting=!0,_ain.atobj.focused=!0,_ain.atobj.videoPlaying=!1,_ain.atobj.sequenceNum=1,window.visibly.onVisible(function(){_ain.atobj.focused=!0}),window.visibly.onHidden(function(){_ain.atobj.focused=!1}),void 0===_ain.atregisterEvent){var n=function(e,n){window.addEventListener?window.addEventListener(e,n,!1):document.attachEvent("on"+e,n)};_ain.atregisterEvent=function(){_ain.atobj._lastEvent=(new Date).getTime()};for(var t=0;t<_ain.atobj.eventNames.length;t++)n(_ain.atobj.eventNames[t],_ain.atregisterEvent);_ain.atsample=function(){var e=(new Date).getTime();_ain.atobj.isInteracting=e-_ain.atobj._lastEvent<1e3*_ain.atobj.activeTimeout,_ain.atobj.isEngaged=_ain.atobj.isInteracting&&_ain.atobj.focused||_ain.atobj.videoPlaying,_ain.atobj._engagedMs+=_ain.atobj.isEngaged?e-_ain.atobj._lastSample:0,_ain.atobj._lastSample=e},window.setInterval(_ain.atsample,1e3*_ain.atobj.sampleRateSeconds),_ain.atsendBeat=function(){!1===j._mcel&&(j._mcel=_ain.getMainContentEl(j.maincontent),j._mcel||_ain.errors.push(_ain.E_NO_EL));var e=Math.round(_ain.atobj._engagedMs/1e3);if(e>0&&e<=Math.round(_ain.atobj.secondsBetweenBeats)){_ain.atobj._engagedMsTotal+=e;var n="?d="+_ain.atparams.d+"&f="+_ain.atparams.did+_ain.atparams.pid+"&b="+r+"&u="+_ain.atparams.h+"&ul="+_ain.atparams.f+"&at="+_ain.atobj._engagedMsTotal+"&ar="+e+(j._mcel?"&sp="+getMainContentPosition(j._mcel):"")+"&ts="+Math.floor(Date.now()/1e3)+"&seq="+_ain.atobj.sequenceNum+++"&x="+_ain.atparams.x+"&err="+prepareParam(_ain.errors.join())+"&ver="+_ain.version+(_ain.getUID()?"&uid="+_ain.getUID():"");sendRequest(_ain.config.at_url,n)}_ain.atobj._engagedMs=0},window.setInterval(_ain.atsendBeat,1e3*_ain.atobj.secondsBetweenBeats),n("unload",_ain.atsendBeat)}}()}},_ain.LOADED=!0,"function"==typeof _ain.onload&&_ain.onload(),"undefined"!==_ain.trackauto&&!1===_ain.trackauto||_ain.track(),"undefined"!==_ain.widgetauto&&!1===_ain.widgetauto||_ain.precessWidgets();